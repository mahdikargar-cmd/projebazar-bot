import { CustomContext } from '../../types/telegraf';
import { userRepo } from '../../shared/container';

export const referralHandler = async (ctx: CustomContext) => {
    const telegramId = String(ctx.from?.id);

    const user = await userRepo.getUserByTelegramId(telegramId);
    if (!user) {
        ctx.reply('â˜ºï¸ Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ /start Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯.');
        return;
    }

    const referralLink = `t.me/${process.env.BOT_USERNAME}?start=ref_${telegramId}`;
    const referralCount = await userRepo.getReferralCount(telegramId);

    ctx.reply(
        `ğŸ“¨ Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø´Ù…Ø§:\n${referralLink}\n\n` +
        `ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯ÙˆØ³ØªØ§Ù† Ø¯Ø¹ÙˆØªâ€ŒØ´Ø¯Ù‡: ${referralCount}\n` +
        `ğŸ’° Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¯ÙˆØ³Øª Ú©Ù‡ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø´Ù…Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†Ø¯ØŒ 10 Ø³Ú©Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯!`
    );
};